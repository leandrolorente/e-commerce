<div class="profile-container">
  <div class="profile-sidebar">
    <div class="user-card">
      @if (profile()) {
        <img [src]="profile()!.photo || 'https://i.pravatar.cc/150'" [alt]="profile()!.name" class="user-photo">
        <h3>{{ profile()!.name }}</h3>
        <p>{{ profile()!.email }}</p>
      }
    </div>
    <nav class="profile-nav">
      <button [class.active]="activeTab() === 'profile'" (click)="switchTab('profile')">
        üë§ Meu Perfil
      </button>
      <button [class.active]="activeTab() === 'password'" (click)="switchTab('password')">
        üîí Alterar Senha
      </button>
      <button [class.active]="activeTab() === 'addresses'" (click)="switchTab('addresses')">
        üìç Endere√ßos
      </button>
      <a routerLink="/user/orders" class="nav-link">
        üì¶ Meus Pedidos
      </a>
      <button class="logout-btn" (click)="logout()">
        üö™ Sair
      </button>
    </nav>
  </div>

  <div class="profile-content">
    <!-- Perfil Tab -->
    @if (activeTab() === 'profile') {
      <div class="content-section">
        <div class="section-header">
          <h2>Dados Pessoais</h2>
          @if (!isEditingProfile()) {
            <button class="btn-edit" (click)="enableProfileEdit()">‚úèÔ∏è Editar</button>
          }
        </div>

        @if (isEditingProfile()) {
          <form class="profile-form" (ngSubmit)="saveProfile()">
            <div class="form-group">
              <label>Nome Completo</label>
              <input type="text" [(ngModel)]="profileForm.name" name="name" required>
            </div>
            <div class="form-row">
              <div class="form-group">
                <label>Email</label>
                <input type="email" [(ngModel)]="profileForm.email" name="email" required>
              </div>
              <div class="form-group">
                <label>Telefone</label>
                <input type="tel" [(ngModel)]="profileForm.phone" name="phone">
              </div>
            </div>
            <div class="form-row">
              <div class="form-group">
                <label>CPF</label>
                <input type="text" [(ngModel)]="profileForm.cpf" name="cpf">
              </div>
              <div class="form-group">
                <label>Data de Nascimento</label>
                <input type="date" [(ngModel)]="profileForm.birthDate" name="birthDate">
              </div>
            </div>
            <div class="form-actions">
              <button type="button" class="btn-cancel" (click)="cancelProfileEdit()">Cancelar</button>
              <button type="submit" class="btn-save" [disabled]="isSaving()">
                {{ isSaving() ? 'Salvando...' : 'Salvar Altera√ß√µes' }}
              </button>
            </div>
          </form>
        } @else {
          <div class="profile-info">
            <div class="info-item">
              <strong>Nome:</strong>
              <span>{{ profile()?.name }}</span>
            </div>
            <div class="info-item">
              <strong>Email:</strong>
              <span>{{ profile()?.email }}</span>
            </div>
            <div class="info-item">
              <strong>Telefone:</strong>
              <span>{{ profile()?.phone }}</span>
            </div>
            <div class="info-item">
              <strong>CPF:</strong>
              <span>{{ profile()?.cpf || 'N√£o informado' }}</span>
            </div>
            <div class="info-item">
              <strong>Data de Nascimento:</strong>
              <span>{{ profile()?.birthDate ? (profile()!.birthDate | date: 'dd/MM/yyyy') : 'N√£o informado' }}</span>
            </div>
          </div>
        }
      </div>
    }

    <!-- Senha Tab -->
    @if (activeTab() === 'password') {
      <div class="content-section">
        <h2>Alterar Senha</h2>
        <form class="password-form" (ngSubmit)="changePassword()">
          <div class="form-group">
            <label>Senha Atual</label>
            <input type="password" [(ngModel)]="passwordForm.currentPassword" name="currentPassword" required>
          </div>
          <div class="form-group">
            <label>Nova Senha</label>
            <input type="password" [(ngModel)]="passwordForm.newPassword" name="newPassword" required>
          </div>
          <div class="form-group">
            <label>Confirmar Nova Senha</label>
            <input type="password" [(ngModel)]="passwordForm.confirmPassword" name="confirmPassword" required>
          </div>
          <button type="submit" class="btn-save" [disabled]="isSaving()">
            {{ isSaving() ? 'Alterando...' : 'Alterar Senha' }}
          </button>
        </form>
      </div>
    }

    <!-- Endere√ßos Tab -->
    @if (activeTab() === 'addresses') {
      <div class="content-section">
        <div class="section-header">
          <h2>Meus Endere√ßos</h2>
          <button class="btn-add" (click)="openAddressModal()">‚ûï Adicionar Endere√ßo</button>
        </div>

        <div class="addresses-grid">
          @for (address of addresses(); track address.id) {
            <div class="address-card" [class.default]="address.isDefault">
              @if (address.isDefault) {
                <span class="default-badge">Padr√£o</span>
              }
              <h4>{{ address.label }}</h4>
              <p>{{ address.street }}, {{ address.number }}</p>
              @if (address.complement) {
                <p>{{ address.complement }}</p>
              }
              <p>{{ address.neighborhood }}</p>
              <p>{{ address.city }} - {{ address.state }}</p>
              <p>CEP: {{ address.zipCode }}</p>
              <div class="address-actions">
                @if (!address.isDefault) {
                  <button (click)="setDefaultAddress(address.id)">Definir como padr√£o</button>
                }
                <button (click)="deleteAddress(address.id)" class="btn-delete">Excluir</button>
              </div>
            </div>
          }
        </div>
      </div>
    }
  </div>
</div>

<!-- Modal Adicionar Endere√ßo -->
@if (showAddressModal()) {
  <div class="modal-overlay" (click)="closeAddressModal()">
    <div class="modal-content" (click)="$event.stopPropagation()">
      <h3>Adicionar Endere√ßo</h3>
      <form (ngSubmit)="saveAddress()">
        <div class="form-group">
          <label>Nome do Endere√ßo</label>
          <input type="text" [(ngModel)]="addressForm.label" name="label" placeholder="Ex: Casa, Trabalho" required>
        </div>
        <div class="form-group">
          <label>CEP</label>
          <input type="text" [(ngModel)]="addressForm.zipCode" name="zipCode" required>
        </div>
        <div class="form-row">
          <div class="form-group">
            <label>Rua</label>
            <input type="text" [(ngModel)]="addressForm.street" name="street" required>
          </div>
          <div class="form-group">
            <label>N√∫mero</label>
            <input type="text" [(ngModel)]="addressForm.number" name="number" required>
          </div>
        </div>
        <div class="form-group">
          <label>Complemento</label>
          <input type="text" [(ngModel)]="addressForm.complement" name="complement">
        </div>
        <div class="form-group">
          <label>Bairro</label>
          <input type="text" [(ngModel)]="addressForm.neighborhood" name="neighborhood" required>
        </div>
        <div class="form-row">
          <div class="form-group">
            <label>Cidade</label>
            <input type="text" [(ngModel)]="addressForm.city" name="city" required>
          </div>
          <div class="form-group">
            <label>Estado</label>
            <select [(ngModel)]="addressForm.state" name="state" required>
              <option value="SP">S√£o Paulo</option>
              <option value="RJ">Rio de Janeiro</option>
              <!-- Adicionar outros estados -->
            </select>
          </div>
        </div>
        <div class="modal-actions">
          <button type="button" class="btn-cancel" (click)="closeAddressModal()">Cancelar</button>
          <button type="submit" class="btn-save" [disabled]="isSaving()">Salvar</button>
        </div>
      </form>
    </div>
  </div>
}
